{% extends "surtax/base.html" %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex justify-between items-center">
        <div>
            <h2 class="text-2xl font-bold text-gray-900">Capital Construction Projects</h2>
            <p class="text-gray-500">Major facility construction and school improvements</p>
        </div>
        <div class="flex items-center gap-3">
            <span class="text-sm text-gray-500">Last updated: {{ "now"|date_format }}</span>
            <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                </svg>
                Export Report
            </button>
        </div>
    </div>

    <!-- Summary Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
            <p class="text-sm font-medium opacity-90">Total Projects</p>
            <p class="text-3xl font-bold mt-2">{{ stats.total_projects }}</p>
            <p class="text-xs opacity-75 mt-1">Active & Planned</p>
        </div>
        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
            <p class="text-sm font-medium opacity-90">Known Budget</p>
            <p class="text-3xl font-bold mt-2">{{ stats.total_budget|currency }}</p>
            <p class="text-xs opacity-75 mt-1">{{ stats.projects_with_budget }} projects</p>
        </div>
        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white">
            <p class="text-sm font-medium opacity-90">Spent to Date</p>
            <p class="text-3xl font-bold mt-2">{{ stats.total_spent|currency }}</p>
            <p class="text-xs opacity-75 mt-1">{{ ((stats.total_spent/stats.total_budget*100) if stats.total_budget > 0 else 0)|round|int }}% of budget</p>
        </div>
        <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-lg p-6 text-white">
            <p class="text-sm font-medium opacity-90">Projects by Status</p>
            <div class="mt-2 space-y-1">
                {% for status_count in status_counts %}
                <p class="text-sm">{{ status_count.status }}: {{ status_count.count }}</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Project Cards -->
    <div class="space-y-4">
        {% for project in projects %}
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow">
            <!-- Project Header -->
            <div class="flex justify-between items-start mb-4">
                <div class="flex-1">
                    <div class="flex items-center gap-3">
                        <h3 class="text-xl font-bold text-gray-900">{{ project.project_name }}</h3>
                        {% if project.status == 'Under Construction' %}
                        <span class="px-3 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full">{{ project.status }}</span>
                        {% elif project.status == 'Planning/Design' %}
                        <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full">{{ project.status }}</span>
                        {% else %}
                        <span class="px-3 py-1 bg-gray-100 text-gray-800 text-xs font-semibold rounded-full">{{ project.status }}</span>
                        {% endif %}
                    </div>
                    <div class="flex items-center gap-2 mt-2 text-sm text-gray-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <span>{{ project.location }}</span>
                        {% if project.address %}
                        <span class="text-gray-400">â€¢</span>
                        <span>{{ project.address }}</span>
                        {% endif %}
                    </div>
                </div>
                <div class="text-right">
                    {% if project.budget_amount %}
                    <p class="text-2xl font-bold text-gray-900">{{ project.budget_amount|currency_full }}</p>
                    <p class="text-xs text-gray-500">Total Budget</p>
                    {% else %}
                    <p class="text-lg font-semibold text-gray-500">Budget TBD</p>
                    {% endif %}
                </div>
            </div>

            <!-- Project Description -->
            <p class="text-gray-700 mb-4">{{ project.description }}</p>

            <!-- Project Details Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 bg-gray-50 rounded-lg p-4">
                <div>
                    <p class="text-xs text-gray-500 uppercase tracking-wide">Type</p>
                    <p class="font-semibold text-gray-900">{{ project.project_type }}</p>
                </div>
                {% if project.capacity %}
                <div>
                    <p class="text-xs text-gray-500 uppercase tracking-wide">Capacity</p>
                    <p class="font-semibold text-gray-900">{{ '{:,}'.format(project.capacity) }} students</p>
                </div>
                {% endif %}
                {% if project.num_classrooms %}
                <div>
                    <p class="text-xs text-gray-500 uppercase tracking-wide">Classrooms</p>
                    <p class="font-semibold text-gray-900">{{ project.num_classrooms }}</p>
                </div>
                {% endif %}
                {% if project.num_labs %}
                <div>
                    <p class="text-xs text-gray-500 uppercase tracking-wide">Labs</p>
                    <p class="font-semibold text-gray-900">{{ project.num_labs }}</p>
                </div>
                {% endif %}
                {% if project.start_date %}
                <div>
                    <p class="text-xs text-gray-500 uppercase tracking-wide">Start Date</p>
                    <p class="font-semibold text-gray-900">{{ project.start_date }}</p>
                </div>
                {% endif %}
                {% if project.estimated_completion %}
                <div>
                    <p class="text-xs text-gray-500 uppercase tracking-wide">Completion</p>
                    <p class="font-semibold text-gray-900">{{ project.estimated_completion }}</p>
                </div>
                {% endif %}
                {% if project.construction_manager %}
                <div>
                    <p class="text-xs text-gray-500 uppercase tracking-wide">Construction Manager</p>
                    <p class="font-semibold text-gray-900">{{ project.construction_manager }}</p>
                </div>
                {% endif %}
                {% if project.cm_contract_amount %}
                <div>
                    <p class="text-xs text-gray-500 uppercase tracking-wide">CM Contract</p>
                    <p class="font-semibold text-gray-900">{{ project.cm_contract_amount|currency_full }}</p>
                </div>
                {% endif %}
            </div>

            <!-- Data Source -->
            <div class="mt-4 pt-4 border-t border-gray-200 flex items-center justify-between">
                <div class="text-xs text-gray-500">
                    <span>Source: {{ project.data_source }}</span>
                </div>
                {% if project.source_url %}
                <a href="{{ project.source_url }}" target="_blank" class="text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1">
                    <span>View Source</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                    </svg>
                </a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Data Notice -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex items-start">
            <svg class="w-5 h-5 text-blue-600 mt-0.5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
                <p class="text-sm font-semibold text-blue-900">Data Sources & Updates</p>
                <p class="text-sm text-blue-800 mt-1">
                    Project information is compiled from Marion County Public Schools Facilities Department,
                    local news sources, and public records. Budget figures for some projects are pending
                    guaranteed maximum price determinations. For the most current information, contact
                    MCPS Facilities at 352-671-6902.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
