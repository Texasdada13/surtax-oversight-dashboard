{% extends "surtax/base.html" %}

{% block content %}
<!-- Page Header -->
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">School Lookup</h1>
    <p class="text-gray-500 mt-1">Find surtax-funded projects at any Marion County school</p>
</div>

<!-- Search -->
<div class="bg-white rounded-xl shadow-sm p-6 mb-8">
    <div class="max-w-xl">
        <label class="block text-sm font-medium text-gray-700 mb-2">Search for a school</label>
        <div class="relative">
            <input type="text" id="schoolSearch" placeholder="Enter school name..."
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                   onkeyup="filterSchools()">
            <svg class="w-5 h-5 text-gray-400 absolute right-3 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
        </div>
    </div>
</div>

<!-- School Type Tabs -->
<div class="flex gap-2 mb-6 overflow-x-auto pb-2">
    <button onclick="filterByType('all')" class="filter-btn active px-4 py-2 rounded-lg text-sm font-medium bg-blue-600 text-white">
        All Schools
    </button>
    <button onclick="filterByType('Elementary')" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
        Elementary
    </button>
    <button onclick="filterByType('Middle')" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
        Middle
    </button>
    <button onclick="filterByType('High')" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
        High
    </button>
</div>

<!-- Schools Grid -->
<div id="schoolsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for school in schools %}
    <a href="{{ url_for('school_detail', school_id=school.school_id) }}"
       class="school-card bg-white rounded-xl shadow-sm p-5 hover:shadow-md transition-shadow card-hover"
       data-name="{{ school.school_name|lower }}"
       data-type="{{ school.school_type }}">
        <div class="flex items-start justify-between mb-3">
            <div>
                <h3 class="font-semibold text-gray-900">{{ school.school_name }}</h3>
                <p class="text-sm text-gray-500">{{ school.school_type }} School</p>
            </div>
            <span class="px-2 py-1 text-xs font-medium rounded-full
                {% if school.school_type == 'Elementary' %}bg-green-100 text-green-700
                {% elif school.school_type == 'Middle' %}bg-blue-100 text-blue-700
                {% elif school.school_type == 'High' %}bg-purple-100 text-purple-700
                {% else %}bg-gray-100 text-gray-700{% endif %}">
                {{ school.school_type }}
            </span>
        </div>

        {% if school.project_count > 0 %}
        <div class="flex items-center justify-between text-sm">
            <span class="text-gray-600">{{ school.project_count }} project{{ 's' if school.project_count != 1 }}</span>
            <span class="font-medium text-gray-900">{{ school.total_budget|currency }}</span>
        </div>
        {% else %}
        <p class="text-sm text-gray-400">No active surtax projects</p>
        {% endif %}

        {% if school.zone %}
        <p class="text-xs text-gray-400 mt-2">Zone: {{ school.zone }}</p>
        {% endif %}
    </a>
    {% endfor %}
</div>

<!-- No Results -->
<div id="noResults" class="hidden bg-white rounded-xl shadow-sm p-12 text-center">
    <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
    </svg>
    <p class="text-gray-500">No schools match your search</p>
</div>

<script>
let currentType = 'all';

function filterSchools() {
    const search = document.getElementById('schoolSearch').value.toLowerCase();
    const cards = document.querySelectorAll('.school-card');
    let visibleCount = 0;

    cards.forEach(card => {
        const name = card.dataset.name;
        const type = card.dataset.type;

        const matchesSearch = name.includes(search);
        const matchesType = currentType === 'all' || type === currentType;

        if (matchesSearch && matchesType) {
            card.classList.remove('hidden');
            visibleCount++;
        } else {
            card.classList.add('hidden');
        }
    });

    document.getElementById('noResults').classList.toggle('hidden', visibleCount > 0);
}

function filterByType(type) {
    currentType = type;

    // Update button states
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active', 'bg-blue-600', 'text-white');
        btn.classList.add('bg-gray-100', 'text-gray-700');
    });
    event.target.classList.add('active', 'bg-blue-600', 'text-white');
    event.target.classList.remove('bg-gray-100', 'text-gray-700');

    filterSchools();
}
</script>
{% endblock %}
